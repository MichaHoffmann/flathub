app-id: com.seventhstring.Transcribe
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: transcribe-wrapper
rename-desktop-file: seventhstring-transcribe.desktop
rename-icon: seventhstring-transcribe
finish-args:
- --share=ipc
- --socket=x11
- --socket=pulseaudio
- --filesystem=xdg-config/transcribe:create
- --filesystem=xdg-music
modules:

- name: transcribe-wrapper
  buildsystem: simple
  build-commands:
  - install -D -m755 -t /app/bin/ transcribe-wrapper
  sources:
  - type: script
    dest-filename: transcribe-wrapper
    commands:
    - HOME=$XDG_CONFIG_HOME/transcribe /app/tmp/bin/transcribe/transcribe

- name: transcribe-metadata
  buildsystem: simple
  build-commands:
  - install -D -m644 -t /app/share/metainfo com.seventhstring.Transcribe.metainfo.xml
  sources:
  - type: file
    path: com.seventhstring.Transcribe.metainfo.xml

- name: transcribe
  buildsystem: simple
  build-commands:
  - bash install-linux.sh -i
  build-options:
    env:
      HOME: /app/tmp
      XDG_DATA_HOME: /app/share
  sources:
  - type: archive
    url: https://www.seventhstring.com/xscribe/downlo/xscsetup-9.10.0.tar.gz
    sha256: 1eb061356c02b0c11e600519d793abb33c9af4c01d3efcd6b8c95fb5a015e58b
  post-install:
  - "sed -i s:Exec=/app/tmp/bin/transcribe/transcribe:Exec=/app/bin/transcribe-wrapper: /app/share/applications/seventhstring-transcribe.desktop"
  modules:
  - name: xdg-utils
    buildsystem: autotools
    cleanup: ['*']
    sources:
    - type: archive
      url: https://portland.freedesktop.org/download/xdg-utils-1.1.3.tar.gz
      sha256: d798b08af8a8e2063ddde6c9fa3398ca81484f27dec642c5627ffcaa0d4051d9
    modules:
    - name: links
      buildsystem: autotools
      post-install:
      - ln -s links "${FLATPAK_DEST}/bin/elinks"
      cleanup: ['*']
      sources:
      - type: archive
        url: http://links.twibright.com/download/links-2.21.tar.bz2
        sha256: 285eed8591c7781ec26213df82786665aaa1b9286782e8a7a1a7e2a6e1630d63
    - name: xmlto
      buildsystem: autotools
      cleanup: ['*']
      sources:
      - type: archive
        url: https://releases.pagure.org/xmlto/xmlto-0.0.28.tar.bz2
        sha256: 1130df3a7957eb9f6f0d29e4aa1c75732a7dfb6d639be013859b5c7ec5421276
